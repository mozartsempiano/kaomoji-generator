<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta
			name="description"
			content="Make your custom Kaomoji or select a premade one!"
		/>
		<meta name="keywords" content="kaomoji, japanese, emoticons, emojis" />
		<meta name="author" content="mozartsempiano" />
		<meta name="copyright" content="mozartsempiano" />

		<title>(*‚âß‚àÄ‚â¶*) Kaomoji Generator - Japanese Emoticons</title>

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

		<link rel="stylesheet" href="/assets/css/kaomoji.css" />

		<style id="notification-style"></style>
	</head>

	<body>
		<!-- Preloader -->
		<div id="preloader">
			<div class="loader">
				<div class="loader-kaomoji">d(„ÄÉ‚âßœâ‚â¶„ÄÉ)b</div>
				<div class="loader-text">Loading...</div>
				<div class="loader-spinner"></div>
			</div>
		</div>

		<div id="container-kaomoji" class="fade-in">
			<div id="content">
				<div id="left-col">
					<div id="title">
						<h1>Kaomoji</h1>
						<h1 style="font-size: clamp(2rem, 6em, 6em)">È°îÊñáÂ≠ó</h1>
						<h2 class="subtitle">Japanese Emoticons</h2>
					</div>

					<div id="filters">
						<button
							id="btn-filter"
							class="btn-filter"
							aria-haspopup="dialog"
							aria-expanded="false"
							aria-controls="popup-filters"
							type="button"
						>
							<span class="typography-title-sm">Filter</span>
							<svg viewBox="0 0 24 24" role="presentation" aria-hidden="true">
								<path
									d="M7.41,15.41L12,10.83L16.59,15.41L18,14L12,8L6,14L7.41,15.41Z"
									style="fill: currentColor"
								></path>
							</svg>
						</button>

						<button
							id="btn-clear"
							class="btn-clear"
							type="button"
							aria-disabled="true"
							disabled
						>
							Clear filters
						</button>

						<div
							id="popup-filters"
							class="popup-filters"
							role="region"
							aria-hidden="true"
							aria-labelledby="btn-filter"
							hidden
						>
							<div class="popup-search-container">
								<svg
									class="popup-search-icon"
									viewBox="0 0 24 24"
									aria-hidden="true"
								>
									<path
										d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"
									/>
								</svg>
								<input
									type="text"
									class="popup-search-input"
									placeholder="Search categories..."
									aria-label="Search categories"
								/>
								<button
									class="popup-search-clear"
									aria-label="Clear search"
									hidden
								>
									<svg viewBox="0 0 24 24" aria-hidden="true">
										<path
											d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"
										/>
									</svg>
								</button>
							</div>
							<div
								class="popup-filters-list"
								data-e2eid="category-filter"
							></div>
						</div>
					</div>
					<img src="/assets/img/halftone.png" class="tilt2" />
				</div>
				<div id="left-col-mobile">
					<div id="title">
						<h1>Kaomoji È°îÊñáÂ≠ó</h1>
					</div>

					<div id="filters">
						<button
							id="btn-filter"
							class="btn-filter"
							aria-haspopup="dialog"
							aria-expanded="false"
							aria-controls="popup-filters"
							type="button"
						>
							<span class="typography-title-sm">Filter</span>
							<svg viewBox="0 0 24 24" role="presentation" aria-hidden="true">
								<path
									d="M7.41,15.41L12,10.83L16.59,15.41L18,14L12,8L6,14L7.41,15.41Z"
									style="fill: currentColor"
								></path>
							</svg>
						</button>

						<button
							id="btn-clear"
							class="btn-clear"
							type="button"
							aria-disabled="true"
							disabled
						>
							<svg viewBox="0 0 76 76" aria-hidden="true">
								<path
									d="M 47.5282,42.9497L 42.5784,38L 47.5282,33.0502L 44.9497,30.4718L 40,35.4216L 35.0502,30.4718L 32.4718,33.0502L 37.4216,38L 32.4718,42.9497L 35.0502,45.5282L 40,40.5784L 44.9497,45.5282L 47.5282,42.9497 Z M 18.0147,41.5355L 26.9646,50.4854C 28.0683,51.589 29,52 31,52L 52,52C 54.7614,52 57,49.7614 57,47L 57,29C 57,26.2386 54.7614,24 52,24L 31,24C 29,24 28.0683,24.4113 26.9646,25.5149L 18.0147,34.4645C 16.0621,36.4171 16.0621,39.5829 18.0147,41.5355 Z M 31,49C 30,49 29.6048,48.8828 29.086,48.3641L 20.1361,39.4142C 19.355,38.6332 19.355,37.3669 20.1361,36.5858L 29.086,27.6362C 29.6048,27.1175 30,27 31,27.0001L 52,27.0001C 53.1046,27.0001 54,27.8955 54,29.0001L 54,47.0001C 54,48.1046 53.1046,49.0001 52,49.0001L 31,49 Z"
								/>
							</svg>
						</button>
						<div
							id="popup-filters"
							class="popup-filters"
							role="region"
							aria-hidden="true"
							aria-labelledby="btn-filter"
							hidden
						>
							<div class="popup-search-container">
								<svg
									class="popup-search-icon"
									viewBox="0 0 24 24"
									aria-hidden="true"
								>
									<path
										d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"
									/>
								</svg>
								<input
									type="text"
									class="popup-search-input"
									placeholder="Search categories..."
									aria-label="Search categories"
								/>
								<button
									class="popup-search-clear"
									aria-label="Clear search"
									hidden
								>
									<svg viewBox="0 0 24 24" aria-hidden="true">
										<path
											d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"
										/>
									</svg>
								</button>
							</div>
							<div
								class="popup-filters-list"
								data-e2eid="category-filter"
							></div>
						</div>
					</div>
				</div>
				<div id="right-col">
					<div id="kaomoji-generator">
						<svg
							id="dice-overlay"
							xmlns="http://www.w3.org/2000/svg"
							xml:space="preserve"
							viewBox="0 0 512 512"
						>
							<path
								d="M454.608 111.204 280.557 6.804a47.733 47.733 0 0 0-49.114-.007L57.392 111.204a47.679 47.679 0 0 0-13.555 12.192l207.902 124.707a8.269 8.269 0 0 0 8.518 0L468.16 123.396a47.654 47.654 0 0 0-13.552-12.192zM177.16 131.738c-12.056 8.371-31.302 8.16-42.984-.49-11.684-8.65-11.382-22.463.678-30.842 12.056-8.386 31.304-8.16 42.992.482 11.679 8.651 11.374 22.456-.686 30.85zm199.143 2.388c-12.056 8.38-31.306 8.16-42.992-.49-11.68-8.65-11.378-22.462.685-30.841 12.053-8.38 31.302-8.168 42.985.482 11.683 8.651 11.378 22.455-.678 30.849zm-130.167 124.24L38.004 133.523a47.72 47.72 0 0 0-3.794 18.62v208.084a47.76 47.76 0 0 0 23.182 40.946l174.051 104.392A47.712 47.712 0 0 0 250.157 512V265.464a8.273 8.273 0 0 0-4.021-7.098zM75.845 369.736c-12.052-6.571-21.829-21.671-21.829-33.728 0-12.056 9.777-16.502 21.829-9.931 12.056 6.57 21.826 21.671 21.826 33.728 0 12.056-9.769 16.501-21.826 9.931zm0-121.867c-12.052-6.578-21.829-21.678-21.829-33.728 0-12.056 9.777-16.501 21.829-9.931 12.056 6.571 21.826 21.671 21.826 33.728 0 12.048-9.769 16.502-21.826 9.931zm60.934 94.145c-12.056-6.571-21.826-21.671-21.826-33.728s9.769-16.502 21.826-9.931c12.056 6.571 21.829 21.671 21.829 33.728 0 12.048-9.773 16.502-21.829 9.931zm60.937 94.144c-12.056-6.571-21.83-21.671-21.83-33.727 0-12.049 9.773-16.495 21.83-9.924 12.056 6.57 21.826 21.67 21.826 33.72-.001 12.057-9.77 16.502-21.826 9.931zm0-121.866c-12.056-6.57-21.83-21.671-21.83-33.727 0-12.056 9.773-16.502 21.83-9.931 12.056 6.571 21.826 21.671 21.826 33.727-.001 12.056-9.77 16.502-21.826 9.931zm276.276-180.769L265.864 258.366a8.272 8.272 0 0 0-4.02 7.098V512a47.723 47.723 0 0 0 18.714-6.435l174.051-104.392a47.76 47.76 0 0 0 23.182-40.946V152.143a47.678 47.678 0 0 0-3.799-18.62zm-152.76 129.409c12.053-6.571 21.826-2.125 21.826 9.931 0 12.049-9.773 27.149-21.826 33.72-12.06 6.571-21.83 2.125-21.83-9.924 0-12.055 9.77-27.156 21.83-33.727zm0 185.803c-12.06 6.57-21.83 2.125-21.83-9.931s9.77-27.15 21.83-33.728c12.053-6.571 21.826-2.118 21.826 9.931 0 12.057-9.773 27.157-21.826 33.728zm1.304-71.072c-12.056 6.571-21.83 2.117-21.83-9.939 0-12.048 9.773-27.149 21.83-33.72 12.056-6.57 21.826-2.125 21.826 9.931s-9.77 27.15-21.826 33.728zm104.784 8.74c-12.056 6.571-21.826 2.125-21.826-9.931s9.769-27.156 21.826-33.72c12.056-6.578 21.829-2.133 21.829 9.924 0 12.056-9.773 27.157-21.829 33.727zm0-71.071c-12.056 6.563-21.826 2.125-21.826-9.931s9.769-27.157 21.826-33.728c12.056-6.571 21.829-2.125 21.829 9.931 0 12.049-9.773 27.157-21.829 33.728zm0-71.079c-12.056 6.57-21.826 2.125-21.826-9.924 0-12.056 9.769-27.157 21.826-33.728 12.056-6.571 21.829-2.125 21.829 9.931 0 12.05-9.773 27.15-21.829 33.721z"
								class="st0"
							/>
						</svg>
						<h2>Kaomoji Generator</h2>
						<div id="generator-inputs"></div>
						<div id="kaomoji-preview">
							<pre title="Click to copy"></pre>
							<button id="generate-random">Random</button>
							<!-- <button id="copy-generated">Copy Kaomoji</button> -->
						</div>
					</div>

					<div id="kaomoji-list"></div>
				</div>
			</div>

			<div id="copy-notification"></div>

			<footer>
				<div>
					<a
						href="https://github.com/mozartsempiano/kaomoji-generator"
						title="GitHub"
					>
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
							<path
								fill-rule="evenodd"
								d="M94 7399c5.523 0 10 4.59 10 10.253 0 4.529-2.862 8.371-6.833 9.728-.507.101-.687-.219-.687-.492 0-.338.012-1.442.012-2.814 0-.956-.32-1.58-.679-1.898 2.227-.254 4.567-1.121 4.567-5.059 0-1.12-.388-2.034-1.03-2.752.104-.259.447-1.302-.098-2.714 0 0-.838-.275-2.747 1.051a9.396 9.396 0 0 0-2.505-.345 9.375 9.375 0 0 0-2.503.345c-1.911-1.326-2.751-1.051-2.751-1.051-.543 1.412-.2 2.455-.097 2.714-.639.718-1.03 1.632-1.03 2.752 0 3.928 2.335 4.808 4.556 5.067-.286.256-.545.708-.635 1.371-.57.262-2.018.715-2.91-.852 0 0-.529-.985-1.533-1.057 0 0-.975-.013-.068.623 0 0 .655.315 1.11 1.5 0 0 .587 1.83 3.369 1.21.005.857.014 1.665.014 1.909 0 .271-.184.588-.683.493-3.974-1.355-6.839-5.199-6.839-9.729 0-5.663 4.478-10.253 10-10.253"
								transform="translate(-84 -7399)"
							/>
						</svg>
					</a>
				</div>
				<div>
					¬©2025 <a href="https://mozartsempiano.com/">mozartsempiano</a> /
					<a href="https://mozartsempiano.com/doar">Donate</a>
				</div>
			</footer>
		</div>
		<script type="module" src="/assets/js/kaomoji.js"></script>
		<script>
			const kaomojis = [
				{ text: "(Ôºæ‚ñΩÔºæ)", tags: ["joy"] },
				{ text: "(‚ïØ¬∞‚ñ°¬∞)‚ïØÔ∏µ ‚îª‚îÅ‚îª", tags: ["anger"] },
				{ text: "(¬¨‚Äø¬¨)", tags: ["cool", "smugness"] },
				{ text: "(‚úø‚ó†‚Äø‚ó†)", tags: ["joy"] },
				{ text: "(‡≤•Ôπè‡≤•)", tags: ["sadness"] },
				{ text: "‡´Æ ‚óû Ôªå ‚óü ·Éê", tags: ["sadness", "dogs", "animals"] },
				{ text: "( Õ°¬∞ Õú ñ Õ°¬∞)", tags: ["smugness"] },
				{ text: "ÍâÇ(ÀµÀÉ ·óú ÀÇÀµ)", tags: ["joy"] },
				{ text: "(À∂·µî ·µï ·µîÀ∂)", tags: ["joy"] },
				{ text: "(‚ï•Ôπè‚ï•)", tags: ["sadness"] },
				{ text: "‡¥¶‡µç‡¥¶‡¥ø ÀâÕàÃÄÍí≥ÀâÕàÃÅ )‚úß", tags: ["joy", "agree"] },
				{ text: "(À∂ÀÉ ·µï ÀÇÀ∂)", tags: ["joy"] },
				{ text: "‚óù(·µî·óú·µî)‚óú", tags: ["joy"] },
				{ text: "‚ô°‚∏ú(ÀÉ ·µï ÀÇ )‚∏ù", tags: ["love"] },
				{ text: "‡¥¶‡µç‡¥¶‡¥ø(·µî·óú·µî)", tags: ["joy", "agree"] },
				{ text: "·ïô(  ‚Ä¢ÃÄ ·óú ‚Ä¢ÃÅ  )·ïó", tags: ["smugness"] },
				{ text: "(À∂ÀÜÍí≥ÀÜÀµ)", tags: ["joy"] },
				{ text: "(¬¨_¬¨')", tags: ["dissatisfaction"] },
				{ text: "‡´ÆÍí∞À∂·µî ·µï ·µîÀ∂Íí±·Éê", tags: ["joy", "sheep", "animals"] },
				{ text: "( ‚âß·óú‚â¶)", tags: ["joy"] },
				{ text: "( ÀòÕà ·µï ÀòÕà‚ô°)", tags: ["love"] },
				{ text: "‚àò ‚àò ‚àò ( ¬∞„ÉÆ¬∞ ) ?", tags: ["confusion"] },
				{ text: "(¬¥ÔΩ°‚Ä¢ ·µï ‚Ä¢ÔΩ°`)", tags: ["joy"] },
				{ text: "(¬¥ÔΩ•_ÔΩ•`)", tags: ["sadness", "confusion"] },
				{ text: "(¬¥‚ñΩ` É‚ô°∆™)", tags: ["love"] },
				{ text: "(‚úßœâ‚úß)", tags: ["joy"] },
				{ text: "(o¬¥‚àÄ`o)", tags: ["joy"] },
				{ text: "(oT-T)Â∞∏", tags: ["sadness"] },
				{ text: "‡´Æ‚Çç ÀÉ ‚§ô ÀÇ ‚Çé·Éê", tags: ["dissatisfaction", "dogs", "animals"] },
				{ text: "; (‚óû‚Ä∏‚óü)", tags: ["sadness", "dissatisfaction"] },
				{ text: "( ‚à©¬¥Õà ·êú `Õà‚à©)", tags: ["embarrassment"] },
				{ text: "(‚äô _ ‚äô )", tags: ["surprise"] },
				{ text: "''( ‚Äì ‚åì ‚Äì )", tags: ["confusion", "indifference"] },
				{ text: "( Àò ¬≥Àò )‚ô°", tags: ["love", "kiss"] },
				{ text: "( ‚Ä¢ ·¥ó - ) ‚úß", tags: ["wink"] },
				{ text: "(À∂Àò ¬≥Àò(¬¥Õà ·µï `ÕàÀ∂)", tags: ["love", "kiss"] },
				{ text: "‚∏ú(‚∏ù‚∏ù‚∏ù¬¥Íí≥`‚∏ù‚∏ù‚∏ù)‚∏ù", tags: ["joy"] },
				{ text: "o(‚âß‚ñΩ‚â¶)o", tags: ["joy"] },
				{ text: "(*‚âßœâ‚â¶*)", tags: ["joy"] },
				{ text: "(‚ÅÄ·ó¢‚ÅÄ)", tags: ["joy"] },
				{ text: "o(>œâ<)o", tags: ["joy"] },
				{ text: "(‚âß‚ó°‚â¶) ‚ô°", tags: ["love"] },
				{ text: "Œ£>‚Äï(„ÄÉ¬∞œâ¬∞„ÄÉ)‚ô°‚Üí", tags: ["love"] },
				{ text: "(‚ÅÑ ‚ÅÑ>‚ÅÑ ‚ñΩ ‚ÅÑ<‚ÅÑ ‚ÅÑ)", tags: ["embarrassment"] },
				{ text: "(„Å£¬¥œâ`)Ôæâ(‚ï•œâ‚ï•)", tags: ["compassion"] },
				{ text: "(·óí·ó£·óï)’û", tags: ["dissatisfaction"] },
				{ text: "(ÔºûÔΩçÔºú)", tags: ["dissatisfaction"] },
				{ text: "(Ôæâ‡≤•Áõä‡≤•)Ôæâ", tags: ["anger"] },
				{ text: "‡≠ß((#Œ¶ÁõäŒ¶#))‡≠®", tags: ["anger"] },
				{ text: "Ÿ©(‡∞†Áõä‡∞†)€∂", tags: ["anger"] },
				{ text: "( ; œâ ; )", tags: ["sadness"] },
				{ text: "(ÔΩ°T œâ TÔΩ°)", tags: ["sadness"] },
				{ text: "(‚ï•Ôπè‚ï•)", tags: ["sadness"] },
				{ text: "(‚ï•_‚ï•)", tags: ["sadness"] },
				{ text: ".¬∑¬∞’û(·óí·ó£·óï)’û¬∞¬∑.", tags: ["sadness"] },
				{ text: "(‚ïØÔ∏µ‚ï∞,)", tags: ["sadness"] },
				{ text: "q(‚ï•Ôπè‚ï•)p", tags: ["sadness"] },
				{ text: "o(T„ÉòTo)", tags: ["sadness"] },
				{ text: "(ÔΩ°‚ïØÔ∏µ‚ï∞ÔΩ°)", tags: ["sadness"] },
				{ text: "(√óÔπè√ó)‚åí‚òÜ", tags: ["pain"] },
				{ text: "(À∂¬∞„ÖÅ¬∞)!!", tags: ["surprise", "fear"] },
				{ text: "Œ£(¬∞„É≠¬∞)!!!", tags: ["surprise", "fear"] },
				{ text: "‚àë(O_O;)", tags: ["surprise"] },
				{ text: "‚ñì‚ñí‚ñë(¬∞‚ó°¬∞)‚ñë‚ñí‚ñì", tags: ["fear"] },
				{ text: "(Ôø£‚ñΩÔø£)„Éé", tags: ["wave"] },
				{ text: "„Éæ(‚òÜ‚ñΩ‚òÜ)", tags: ["wave"] },
				{ text: "( ‚ó°‚Äø‚ó° )", tags: ["joy"] },
				{ text: "(‚óûÔ∏µ‚óü)", tags: ["sadness"] },
				{ text: "(‚ï¨‡≤†Áõä‡≤†)", tags: ["anger"] },
				{ text: " ï‚óâ·¥•‚óâ î", tags: ["bears", "animals"] },
				{ text: " ï‚âß„â®‚â¶ î", tags: ["bears", "animals"] },
				{ text: "(*‚âß‚àÄ‚â¶*)", tags: ["joy"] },
				{ text: "(*¬¥œâ ` *)", tags: ["joy"] },
				{ text: "^‚ÜÄ·¥•‚ÜÄ^", tags: ["cats", "animals"] },
				{ text: "(=‚ÜÄœâ‚ÜÄ=)", tags: ["cats", "animals"] },
				{ text: "(‚îÄ‚Äø‚Äø‚îÄ)", tags: ["joy", "silly"] },
				{ text: "Ôºº(Ôºæ‚ñΩÔºæ)Ôºè", tags: ["joy"] },
				{ text: "(Àò‚àÄÀò)/(Œº‚ÄøŒº) ‚ù§", tags: ["love"] },
				{ text: "(‚ù§œâ‚ù§)", tags: ["love"] },
				{ text: "‚ô°( ‚ó°‚Äø‚ó° )", tags: ["love"] },
				{ text: "(¬¥,,‚Ä¢œâ‚Ä¢,,)‚ô°", tags: ["love"] },
				{ text: "(‚ÅÑ ‚ÅÑ‚Ä¢‚ÅÑœâ‚ÅÑ‚Ä¢‚ÅÑ ‚ÅÑ)", tags: ["embarrassment"] },
				{ text: "(‚Äû‡≤°œâ‡≤°‚Äû)", tags: ["embarrassment", "silly"] },
				{ text: "(„Éé*¬∞‚ñΩ¬∞*)", tags: ["embarrassment"] },
				{ text: "œÅ(- œâ -„ÄÅ)„Éæ(Ôø£œâÔø£; )", tags: ["compassion"] },
				{ text: "„ÉΩ(Ôø£œâÔø£(„ÄÇ„ÄÇ )„Çù", tags: ["compassion"] },
				{ text: "Âá∏(Ôø£„ÉòÔø£)", tags: ["dissatisfaction"] },
				{ text: "(Ôø£ Ôø£|||)", tags: ["dissatisfaction"] },
				{ text: "(Ôø£Ô∏øÔø£)", tags: ["indifference"] },
				{ text: "(‚áÄ‚Ä∏‚Üº‚Ä∂)", tags: ["dissatisfaction"] },
				{ text: "„ÄÇ„Çú„Çú(¬¥ÔºØ`) „Çú„Çú„ÄÇ", tags: ["sadness"] },
				{ text: "ÔºàÔΩâ–îÔΩâÔºâ", tags: ["sadness"] },
				{ text: "( Àò‚ñΩÀò)„Å£‚ô®", tags: ["food"] },
				{ text: "(„ÄÄ¬¥‚àÄ`)„Å§‚Äï‚óè‚óã‚óé-", tags: ["food"] },
				{ text: "‡´Æ‚Çç ¬¥À∂‚Ä¢ ·¥• ‚Ä¢À∂‚Çé·Éê", tags: ["dogs", "animals"] },
				{ text: "‡´Æ‚Çç À∂·µî ·µï ·µîÀ∂ ‚Çé·Éê", tags: ["joy", "dogs", "animals"] },
				{ text: "(‚∏ù‚∏ù ‚óú~‚óù ‚∏ù‚∏ù)", tags: ["embarrassment"] },
				{ text: "(,,·¥ó ¬†Ã´·¥ó,,)Íï§*.Ôæü", tags: ["embarrassment"] },
				{ text: "( ‡©≠ Àô·óúÀô )‡©≠", tags: ["joy"] },
				{ text: "(‚óè¬¥œñ`‚óè)", tags: ["silly"] },
				{ text: "o(„ÄÉÔºæ‚ñΩÔºæ„ÄÉ)o", tags: ["joy"] },
				{ text: "o(‚∏ù‚∏ù¬∫·óú¬∫‚∏ù‚∏ù)>‚ô°", tags: ["love"] },
				{ text: "¬Ø\\_(·êõ )_/¬Ø", tags: ["silly"] },
				{ text: "‚ô°(‚óç‚Ä¢„ÖÖ‚Ä¢‚óç)‚ô°", tags: ["love"] },
				{ text: "‚âΩ^‚Ä¢‚©ä‚Ä¢^‚âº", tags: ["cats", "animals"] },
				{ text: "‚âΩ^À∂‚à©‚©ä‚à©À∂^‚âº", tags: ["embarrassment", "cats", "animals"] },
				{ text: "/·ê†‚Ä¢ Àï ‚Ä¢„Éû", tags: ["cats", "animals"] },
				{ text: "(·ìÄ‚Ä∏·ìÇ)", tags: ["anger"] },
				{ text: "( = ‚©ä = )", tags: ["embarrassment"] },
				{ text: "(‡πë>‚ó°<‡πë)", tags: ["embarrassment", "joy"] },
				{ text: "(·óí‚©ä·óï)", tags: ["embarrassment", "joy"] },
				{ text: "(0Ôºæ„ÉºÔºæ0Ôºâ", tags: ["joy"] },
				{ text: "(‡≤• Õú ñ‡≤•)", tags: ["sadness", "silly"] },
				{ text: "(‚ï¨Ôø£ÁöøÔø£)", tags: ["anger"] },
				{ text: "(@‚Äôœâ‚Äô@)", tags: ["embarrassment"] },
				{ text: "Ÿ©(‡πõ Àò ¬≥Àò)€∂‚ù§", tags: ["love"] },
				{ text: "(=^ÔΩ•œâÔΩ•^=)", tags: ["cats", "animals"] },
				{ text: " ï ‚Äì ·¥• ‚Äì  î", tags: ["cool", "bears", "animals"] },
				{ text: " ï Íàç·¥•Íàç î", tags: ["bears", "animals"] },
				{ text: "( Õ°¬∞ ·¥• Õ°¬∞  ã)", tags: ["dogs", "animals"] },
				{ text: "œÖ¬¥‚Ä¢ Ôªå ‚Ä¢`œÖ", tags: ["dogs", "animals"] },
				{ text: "‡´Æ ÍàçÔªå Íàç·Éê‚ô•(Àò ŒµÀò U)", tags: ["love", "dogs", "animals"] },
				{ text: "( ‚öÜ_‚öÜ )?", tags: ["confusion"] },
				{ text: "(ÔΩ°‚Ä¢ . ‚Ä¢ÔΩ°)??", tags: ["confusion"] },
				{ text: "(ÔºõÔø£–îÔø£)Ôºü", tags: ["confusion"] },
				/*{
          text: `.           .üå∑üå∏üå∑üå∏
          üå∏üå∑üå∏üå∑üå∏
        Œõ üå∑üå∏üå∑üå∏üå∑
      ( Àò ·µï Àò  üå∑üå∏üå∑
       „ÉΩ  „Å§Ôºº     Ôºè
          UU   / üéÄ \\`,
          tags: ["multiple lines", "flowers", "cute"],
        },*/
			];

			const PRE_TITLE = "Clique para copiar";
			function setPreTitles() {
				document.querySelectorAll("pre").forEach((pre) => {
					pre.title = PRE_TITLE;
				});
			}
			const origRenderKaomoji = renderKaomojis;
			renderKaomojis = function (filteredList) {
				origRenderKaomoji(filteredList);
				setPreTitles();
			};
			setPreTitles();

			let sortOrder = "desc"; // "asc" or "desc"

			const list = document.getElementById("kaomoji-list");
			const filtersContainer = document.getElementById("filters");

			/* const allTags = ["All", ...new Set(kaomojis.flatMap((k) => k.tags))]; */
			const allTags = [
				"All",
				...Array.from(new Set(kaomojis.flatMap((k) => k.tags))).sort((a, b) =>
					a.localeCompare(b)
				),
			];

			const activeFilters = new Set();

			// Updates URL according to active filters
			function updateURL() {
				if (activeFilters.size === 0) {
					history.replaceState(null, "", window.location.pathname);
				} else {
					const tagsParam = Array.from(activeFilters).join(",");
					history.replaceState(
						null,
						"",
						`?tags=${encodeURIComponent(tagsParam)}`
					);
				}
			}

			// Initializes filters from URL
			function loadFiltersFromURL() {
				const params = new URLSearchParams(window.location.search);
				const tagsParam = params.get("tags");
				if (tagsParam) {
					tagsParam.split(",").forEach((tag) => {
						if (allTags.includes(tag)) activeFilters.add(tag);
					});
				}
			}

			// Get filter button elements for both desktop and mobile
			const btnFilters = document.querySelectorAll(".btn-filter");
			const popupFiltersAll = document.querySelectorAll(".popup-filters");
			const popupLists = document.querySelectorAll(".popup-filters-list");
			const btnClears = document.querySelectorAll(".btn-clear");

			// Updates the kaomoji list and button/tag classes
			function updateFilters() {
				const filtered =
					activeFilters.size === 0
						? kaomojis
						: kaomojis.filter((k) =>
								Array.from(activeFilters).every((f) => k.tags.includes(f))
						  );

				renderKaomojis(filtered);

				// Updates top buttons
				filtersContainer.querySelectorAll("button").forEach((btn) => {
					const tag = btn.textContent;
					btn.classList.toggle("selected", activeFilters.has(tag));
				});

				// enable/disable the clear buttons under Filter
				btnClears.forEach((btnClear) => {
					if (activeFilters.size > 0) {
						btnClear.removeAttribute("disabled");
						btnClear.setAttribute("aria-disabled", "false");
					} else {
						btnClear.setAttribute("disabled", "true");
						btnClear.setAttribute("aria-disabled", "true");
					}
				});

				updateURL();
				// also refresh popup tag selected state if present
				if (typeof renderPopupTags === "function") renderPopupTags();
			}

			// Build a compact filter UI: a single "Filter" button that opens a popup with all tags
			function openPopup(popupFilters, btnFilter, popupList) {
				popupFilters.hidden = false;
				popupFilters.setAttribute("aria-hidden", "false");
				popupFilters.setAttribute("aria-modal", "true");
				btnFilter.setAttribute("aria-expanded", "true");
				// focus first interactive element (the first checkbox row)
				const firstRow = popupList.querySelector("[role='checkbox']");
				if (firstRow) firstRow.focus();
			}

			function closePopup(popupFilters, btnFilter) {
				popupFilters.hidden = true;
				popupFilters.setAttribute("aria-hidden", "true");
				popupFilters.removeAttribute("aria-modal");
				btnFilter.setAttribute("aria-expanded", "false");
				btnFilter.focus();
			}

			// Setup event listeners for both desktop and mobile filter buttons
			btnFilters.forEach((btnFilter, index) => {
				const popupFilters = popupFiltersAll[index];
				const popupList = popupLists[index];

				btnFilter.addEventListener("click", (e) => {
					if (popupFilters.hidden)
						openPopup(popupFilters, btnFilter, popupList);
					else closePopup(popupFilters, btnFilter);
				});
			});

			// Setup event listeners for both desktop and mobile clear buttons
			btnClears.forEach((btnClear, index) => {
				const popupList = popupLists[index];
				btnClear.addEventListener("click", () => {
					if (activeFilters.size === 0) return; // no-op when disabled
					activeFilters.clear();
					updateFilters();
					// keep popup open and focus first row
					const firstRow = popupList.querySelector("[role='checkbox']");
					if (firstRow) firstRow.focus();
				});
			});

			// close popup on ESC
			document.addEventListener("keydown", (e) => {
				if (e.key === "Escape") {
					popupFiltersAll.forEach((popupFilters, index) => {
						if (!popupFilters.hidden)
							closePopup(popupFilters, btnFilters[index]);
					});
				}
			});

			// close popup when clicking outside of it but ignore clicks on the filter and clear buttons
			document.addEventListener("click", (e) => {
				const target = e.target;
				popupFiltersAll.forEach((popupFilters, index) => {
					if (popupFilters.hidden) return;
					if (popupFilters.contains(target)) return; // inside popup
					const btnFilter = btnFilters[index];
					const btnClear = btnClears[index];
					if (btnFilter && (btnFilter === target || btnFilter.contains(target)))
						return; // clicked Filter
					if (btnClear && (btnClear === target || btnClear.contains(target)))
						return; // clicked clear
					// otherwise close
					closePopup(popupFilters, btnFilter);
				});
			});

			// Basic focus trap: keep Tab/Shift+Tab within popup when open
			document.addEventListener("keydown", (e) => {
				if (e.key !== "Tab") return;

				popupFiltersAll.forEach((popupFilters) => {
					if (popupFilters.hidden) return;

					const focusable = popupFilters.querySelectorAll(
						"[role='checkbox'], button:not([disabled])"
					);
					if (!focusable.length) return;
					const first = focusable[0];
					const last = focusable[focusable.length - 1];

					if (e.shiftKey) {
						if (document.activeElement === first) {
							e.preventDefault();
							last.focus();
						}
					} else {
						if (document.activeElement === last) {
							e.preventDefault();
							first.focus();
						}
					}
				});
			});

			// Render popup as a list of checkbox-like rows with counts
			function renderPopupTags() {
				// Clear all popup lists
				popupLists.forEach((popupList) => {
					popupList.innerHTML = "";
				});

				// compute counts per tag
				const counts = {};
				allTags.forEach((t) => (counts[t] = 0));
				kaomojis.forEach((k) =>
					k.tags.forEach((t) => {
						if (counts[t] !== undefined) counts[t]++;
					})
				);

				allTags.forEach((tag) => {
					// Create row for each popup list
					popupLists.forEach((popupList) => {
						const row = document.createElement("div");
						row.className = "popup-item";
						row.tabIndex = 0;
						// treat "All" specially by showing total
						const isAll = tag === "All";
						const checked = isAll
							? activeFilters.size === 0
							: activeFilters.has(tag);
						row.setAttribute("role", "checkbox");
						row.setAttribute("aria-checked", checked ? "true" : "false");

						// checkbox square
						const cb = document.createElement("span");
						cb.className = "popup-checkbox";
						cb.innerHTML = `<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg>`;

						const label = document.createElement("span");
						label.className = "popup-label";
						label.textContent = tag;

						const countSpan = document.createElement("span");
						countSpan.className = "popup-count";
						countSpan.textContent = isAll
							? `(${kaomojis.length})`
							: `(${counts[tag] || 0})`;

						row.appendChild(cb);
						row.appendChild(label);
						row.appendChild(countSpan);

						// click/keyboard toggles
						function toggle() {
							if (isAll) {
								activeFilters.clear();
							} else {
								if (activeFilters.has(tag)) activeFilters.delete(tag);
								else activeFilters.add(tag);
							}
							updateFilters();
							// re-render rows to update aria-checked and counts
							renderPopupTags();
						}

						row.addEventListener("click", (e) => {
							// prevent the click from bubbling to document: we re-render the popup synchronously
							// which may remove the original target from the DOM and cause the global
							// outside-click handler to close the popup. Stopping propagation here prevents that.
							e.stopPropagation();
							toggle();
						});

						row.addEventListener("keydown", (e) => {
							if (e.key === " " || e.key === "Enter") {
								e.preventDefault();
								e.stopPropagation();
								toggle();
							}
							if (e.key === "Escape") {
								e.stopPropagation();
								// Find which popup this row belongs to and close it
								const popup = row.closest(".popup-filters");
								const popupIndex = Array.from(popupFiltersAll).indexOf(popup);
								if (popupIndex !== -1) {
									closePopup(popup, btnFilters[popupIndex]);
								}
							}
						});

						popupList.appendChild(row);
					});
				});
			}

			renderPopupTags();

			// Search functionality for filtering tags in popups
			let searchQuery = "";

			function filterPopupTags(query) {
				searchQuery = query.toLowerCase().trim();

				popupLists.forEach((popupList) => {
					const items = popupList.querySelectorAll(".popup-item");
					items.forEach((item) => {
						const label = item
							.querySelector(".popup-label")
							.textContent.toLowerCase();
						if (label.includes(searchQuery)) {
							item.style.display = "flex";
						} else {
							item.style.display = "none";
						}
					});
				});
			}

			// Setup search inputs for all popups
			const searchInputs = document.querySelectorAll(".popup-search-input");
			const searchClearButtons = document.querySelectorAll(
				".popup-search-clear"
			);

			searchInputs.forEach((input, index) => {
				const clearBtn = searchClearButtons[index];

				// Input event for live filtering
				input.addEventListener("input", (e) => {
					const value = e.target.value;
					filterPopupTags(value);

					// Show/hide clear button
					if (value) {
						clearBtn.hidden = false;
					} else {
						clearBtn.hidden = true;
					}
				});

				// Clear search when clicking X button
				clearBtn.addEventListener("click", () => {
					input.value = "";
					filterPopupTags("");
					clearBtn.hidden = true;
					input.focus();
				});

				// Clear search when opening popup
				btnFilters.forEach((btnFilter, btnIndex) => {
					btnFilter.addEventListener("click", () => {
						if (btnIndex === index) {
							input.value = "";
							filterPopupTags("");
							clearBtn.hidden = true;
						}
					});
				});
			});

			// Notification text constants
			const NOTIFICATION_TEXTS = {
				SUCCESS: "Copied! ‡¥¶‡µç‡¥¶‡¥ø ÀâÕàÃÄÍí≥ÀâÕàÃÅ )‚úß",
				ERROR: "Error copying! Œ£(¬∞„É≠¬∞)!!!",
			};

			// Renders kaomojis and tags below each one
			function renderKaomojis(filteredList) {
				list.innerHTML = "";

				// Gets the notification div (or creates if it doesn't exist)
				let copyNotification = document.getElementById("copy-notification");
				if (!copyNotification) {
					copyNotification = document.createElement("div");
					copyNotification.id = "copy-notification";
					copyNotification.textContent = NOTIFICATION_TEXTS.SUCCESS;
					document.body.appendChild(copyNotification);
				}

				const timeout = 3000; // notification duration
				let copyTimeout; // controls current timeout

				// --- applies global sorting ---
				let sorted = [...filteredList];
				if (sortOrder === "desc") sorted.reverse();

				sorted.forEach((k) => {
					const container = document.createElement("div");
					container.classList.add("kaomoji-item");

					const pre = document.createElement("pre");
					pre.textContent = k.text;
					pre.style.cursor = "pointer";

					container.appendChild(pre);

					const tagsDiv = document.createElement("div");
					tagsDiv.classList.add("tags");

					k.tags.forEach((t) => {
						const span = document.createElement("span");
						span.textContent = t;
						span.style.cursor = "pointer";
						span.style.marginRight = "6px";

						span.addEventListener("click", () => {
							activeFilters.has(t)
								? activeFilters.delete(t)
								: activeFilters.add(t);
							updateFilters();
						});

						span.classList.toggle("selected", activeFilters.has(t));
						tagsDiv.appendChild(span);
					});

					container.appendChild(tagsDiv);
					list.appendChild(container);
				});

				// --- Delegation: ensures it works for dynamic <pre> elements ---
				const root = document.getElementById("container-kaomoji");
				if (root && !root.dataset.clipboardInit) {
					root.addEventListener("click", async (e) => {
						const pre = e.target.closest("pre");
						if (!pre || !root.contains(pre)) return;

						// Prevent copying if preview is disabled (generating)
						if (
							pre.style.cursor === "progress" ||
							pre.style.userSelect === "none"
						) {
							return;
						}

						const textToCopy = pre.textContent;

						// clears previous timeout
						if (copyTimeout) clearTimeout(copyTimeout);

						// Reset notification classes
						copyNotification.className = "";

						try {
							await navigator.clipboard.writeText(textToCopy);
							copyNotification.textContent = NOTIFICATION_TEXTS.SUCCESS;
							copyNotification.classList.add("show", "notifSuccess");
							playCopySuccess(); // Plays success sound
						} catch (err) {
							console.error("Error copying (clipboard.writeText):", err);

							// old fallback
							try {
								const textarea = document.createElement("textarea");
								textarea.value = textToCopy;
								textarea.setAttribute("readonly", "");
								textarea.style.position = "absolute";
								textarea.style.left = "-9999px";
								document.body.appendChild(textarea);

								textarea.select();
								textarea.setSelectionRange(0, textarea.value.length);

								const successful = document.execCommand("copy");
								document.body.removeChild(textarea);

								if (successful) {
									copyNotification.textContent = NOTIFICATION_TEXTS.SUCCESS;
									copyNotification.classList.add("show", "notifSuccess");
									playCopySuccess(); // Plays success sound in fallback too
								} else {
									copyNotification.textContent = NOTIFICATION_TEXTS.ERROR;
									copyNotification.classList.add("show", "notifError");
									playCopyFail(); // Plays error sound in fallback
								}
							} catch (err2) {
								console.error("Fallback failed:", err2);
								copyNotification.textContent = NOTIFICATION_TEXTS.ERROR;
								copyNotification.classList.add("show", "notifError");
								playCopyFail(); // Plays error sound when everything fails
							}
						}

						// restarts timeout
						copyTimeout = setTimeout(() => {
							copyNotification.classList.remove(
								"show",
								"notifSuccess",
								"notifError"
							);
							copyTimeout = null;
						}, timeout);
					});

					root.dataset.clipboardInit = "1";
				}
			}

			loadFiltersFromURL();
			updateFilters();
		</script>

		<script>
			// === KAOMOJI GENERATOR ===

			const options = {
				extraLeft: [
					"",
					"‚úß",
					"‚àò ‚àò ‚àò",
					"ÍâÇ",
					"?",
					"''",
					"Œ£>‚Äï",
					"!!!",
					"Œ£",
					"‚òÜ‚åí",
					".¬∑¬∞’û",
					"‚ô° ",
					".Ôæü*Íï§",
				],
				armLeft: [
					"",
					"„ÉΩ",
					"‚óù",
					"‚ï≠",
					"o",
					"‰πÅ",
					"q",
					"‡≠ß",
					"·ïô",
					"‡¥¶‡µç‡¥¶‡¥ø",
					"d",
					"„Éæ",
					"‚∏ú",
					"Âá∏",
					" ö",
				],
				faceLeft: [
					"",
					"(",
					"((",
					"(*",
					"(À∂",
					"(‚ô°",
					"(¬¥ÔΩ°",
					"(¬¥",
					"(o",
					"(‚óç",
					"‡´Æ ",
					"‡´Æ‚Çç ",
					"‡´ÆÍí∞",
					" ï",
					"(#",
					"(=",
					"(‚∏ù‚∏ù ",
					"(‚Äû",
					"(„ÄÉ",
					"‡ºº ",
				],
				eyeLeft: [
					"^",
					"‚ó†",
					"·µî",
					"ÀÜ",
					"ÀòÕà",
					"ÀâÕàÃÄ",
					"Ôø£",
					">",
					"Ôºû",
					"·óí",
					"‚âß",
					"¬∞",
					"‚Ä¢",
					"‚Ä¢ÃÄ",
					"ÔΩ•",
					"¬¨",
					"‚Äì",
					"‚äô",
					"O",
					"‡≤†",
					"‡≤•",
					"‡∞†",
					"‚óû",
					"‚ïØ",
					"¬¥",
					"T",
					"‚ï•",
					";",
					"ÔΩâ",
					"Œ¶",
					"‚ÜÄ",
					"‚òÜ",
					"‚úß",
					"√ó",
					" Õ°¬∞",
					"Íàç",
					"‚ô•",
					"‚ô°",
					"·ëå",
					"Ôº†",
					"Õ°U",
					"√≤",
					"‚ãã",
					"·ìÄ",
					"‡∂ß",
				],
				mouth: [
					"‚Äø",
					"·µï",
					"·¥ó",
					"‚ó°",
					"ÔΩñ",
					"Íí≥",
					"œâ",
					"‚Äø‚Äø",
					"‚ñΩ",
					"·óú",
					"·ó¢",
					"„ÉÆ",
					"‚àÄ",
					"–∑",
					"3",
					"¬≥",
					"·ìÄ",
					"Ô∏µ",
					"Ô∏ø",
					"„Éò",
					"‚Ä∏",
					"„ÖÖ",
					"‚åì",
					"·ó£",
					"Œî",
					"_",
					"-",
					"Ôπè",
					"m",
					"√ó",
					"‚§ô",
					"o",
					"‚ñ°",
					"„É≠",
					"–î",
					"Áõä",
					" Õú ñ",
					"œñ",
					"·¥•",
					"‹´",
					"(ÔΩ™)",
					"„â®",
				],
				eyeRight: [
					"^",
					"‚ó†",
					"·µî",
					"ÀÜ",
					"ÀòÕà",
					"ÀâÕàÃÅ",
					"Ôø£",
					"<",
					"Ôºú",
					"·óï",
					"‚â¶",
					"¬∞",
					"‚Ä¢",
					"‚Ä¢ÃÅ",
					"ÔΩ•",
					"¬¨",
					"‚Äì",
					"‚äô",
					"O",
					"‡≤†",
					"‡≤•",
					"‡∞†",
					"‚óü",
					"‚ï∞",
					"`",
					"T",
					"‚ï•",
					";",
					"ÔΩâ",
					"Œ¶",
					"‚ÜÄ",
					"‚òÜ",
					"‚úß",
					"√ó",
					" Õ°¬∞",
					"Íàç",
					"‚ô•",
					"‚ô°",
					"·ëå",
					"Ôº†",
					"Õ°U",
					"√≥",
					"‚ãå",
					"·ìÇ",
					"‡∂ß",
				],
				faceRight: [
					"",
					")",
					"))",
					"*)",
					"À∂)",
					"‚ô°)",
					"ÔΩ°`)",
					"`)",
					"o)",
					"‚óç)",
					" ·Éê",
					" ‚Çé·Éê",
					"Íí±·Éê",
					" î",
					"#)",
					"=)",
					" ‚∏ù‚∏ù)",
					"‚Äû)",
					"„ÄÉ)",
					" ‡ºΩ",
				],
				armRight: [
					"",
					"Ôæâ",
					"‚óú",
					"‚ïÆ",
					"o",
					"„Ñè",
					"p",
					"‡≠®",
					"·ïó",
					"‡¥¶‡µç‡¥¶‡¥ø",
					"b",
					"„Éæ",
					"‚∏ù",
					"Âá∏",
					"…û",
				],
				extraRight: [
					"",
					"‚úß",
					"‚àò ‚àò ‚àò",
					"ÍâÇ",
					"?",
					"''",
					"‚ô°‚Üí",
					"!!!",
					"Œ£",
					"‚åí‚òÜ",
					"’û¬∞¬∑.",
					" ‚ô°",
					"Íï§*.Ôæü",
				],
			};

			const inputsContainer = document.getElementById("generator-inputs");
			const preview = document.querySelector("#kaomoji-preview pre");
			/* const btnCopy = document.getElementById("copy-generated"); */

			const parts = {}; // stores select references

			// Creates selects
			Object.entries(options).forEach(([part, values]) => {
				const label = document.createElement("label");
				label.textContent = part + ": ";

				const select = document.createElement("select");
				values.forEach((val, index) => {
					const option = document.createElement("option");
					option.value = val;
					option.textContent = index + 1 + ". " + (val || "‚†Ä"); // number for visualization
					select.appendChild(option);
				});

				parts[part] = select;
				label.appendChild(select);
				inputsContainer.appendChild(label);
				inputsContainer.appendChild(document.createElement("br"));
			});

			// Updates preview according to selection
			function updateKaomoji() {
				const kaomoji = `${parts.extraLeft.value}${parts.armLeft.value}${parts.faceLeft.value}${parts.eyeLeft.value}${parts.mouth.value}${parts.eyeRight.value}${parts.faceRight.value}${parts.armRight.value}${parts.extraRight.value}`;
				preview.textContent = kaomoji;
			}

			// Observes changes in selects
			Object.values(parts).forEach((sel) =>
				sel.addEventListener("change", updateKaomoji)
			);

			// Copy
			/* btnCopy.addEventListener("click", () => {
			           navigator.clipboard.writeText(preview.textContent).then(() => {
			             btnCopy.textContent = "Copied!";
			             setTimeout(() => (btnCopy.textContent = "Copy Kaomoji"), 2000);
			           });
			         }); */

			const btnRandom = document.getElementById("generate-random");
			let slotMachineActive = true;

			const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
			let tickBuffer = null;
			let copySuccessBuffer = null;
			let copyFailBuffer = null;

			async function loadTickBuffer(url) {
				try {
					const res = await fetch(url);
					const arr = await res.arrayBuffer();
					tickBuffer = await audioCtx.decodeAudioData(arr);
				} catch (err) {
					console.warn("Failed to load tick audio:", err);
					tickBuffer = null;
				}
			}

			async function loadCopySuccessBuffer(url) {
				try {
					const res = await fetch(url);
					const arr = await res.arrayBuffer();
					copySuccessBuffer = await audioCtx.decodeAudioData(arr);
				} catch (err) {
					console.warn("Failed to load copy success audio:", err);
					copySuccessBuffer = null;
				}
			}

			async function loadCopyFailBuffer(url) {
				try {
					const res = await fetch(url);
					const arr = await res.arrayBuffer();
					copyFailBuffer = await audioCtx.decodeAudioData(arr);
				} catch (err) {
					console.warn("Failed to load copy fail audio:", err);
					copyFailBuffer = null;
				}
			}

			loadTickBuffer("/assets/wav/random_tick.wav");
			loadCopySuccessBuffer("/assets/wav/copy_success.wav");
			loadCopyFailBuffer("/assets/wav/copy_fail.wav");

			function playTick(volume = 0.55) {
				if (!tickBuffer) return;
				if (audioCtx.state === "suspended") {
					audioCtx.resume().catch(() => {});
				}

				const src = audioCtx.createBufferSource();
				src.buffer = tickBuffer;

				const gain = audioCtx.createGain();
				gain.gain.value = 0.0001;

				src.connect(gain).connect(audioCtx.destination);

				const now = audioCtx.currentTime;
				// quick attack to smooth and avoid clicks, with short decay
				gain.gain.setValueAtTime(0.0001, now);
				gain.gain.exponentialRampToValueAtTime(
					Math.max(0.001, volume),
					now + 0.001
				);
				gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.12);

				src.start(now);
				src.stop(now + tickBuffer.duration + 0.02);
			}

			function playCopySuccess(volume = 0.4) {
				if (!copySuccessBuffer) return;
				if (audioCtx.state === "suspended") {
					audioCtx.resume().catch(() => {});
				}

				const src = audioCtx.createBufferSource();
				src.buffer = copySuccessBuffer;

				const gain = audioCtx.createGain();
				gain.gain.value = 0.0001;

				src.connect(gain).connect(audioCtx.destination);

				const now = audioCtx.currentTime;
				// smooth attack and decay for success sound
				gain.gain.setValueAtTime(0.0001, now);
				gain.gain.exponentialRampToValueAtTime(
					Math.max(0.001, volume),
					now + 0.01
				);
				gain.gain.exponentialRampToValueAtTime(
					0.0001,
					now + copySuccessBuffer.duration
				);

				src.start(now);
				src.stop(now + copySuccessBuffer.duration + 0.02);
			}

			function playCopyFail(volume = 0.5) {
				if (!copyFailBuffer) return;
				if (audioCtx.state === "suspended") {
					audioCtx.resume().catch(() => {});
				}

				const src = audioCtx.createBufferSource();
				src.buffer = copyFailBuffer;

				const gain = audioCtx.createGain();
				gain.gain.value = 0.0001;

				src.connect(gain).connect(audioCtx.destination);

				const now = audioCtx.currentTime;
				// error sound with more abrupt attack
				gain.gain.setValueAtTime(0.0001, now);
				gain.gain.exponentialRampToValueAtTime(
					Math.max(0.001, volume),
					now + 0.005
				);
				gain.gain.exponentialRampToValueAtTime(
					0.0001,
					now + copyFailBuffer.duration
				);

				src.start(now);
				src.stop(now + copyFailBuffer.duration + 0.02);
			}

			function animateOrChange(select, targetIndex, callback) {
				if (slotMachineActive) {
					animatePart(select, targetIndex, callback);
				} else {
					select.selectedIndex = targetIndex;
					updateKaomoji();
					if (callback) callback();
				}
			}

			function animatePart(select, targetIndex, callback) {
				let current = select.selectedIndex;
				let step = targetIndex > current ? 1 : -1;
				let diff = Math.abs(targetIndex - current);
				let i = 0;
				let delay = 20;

				function frame() {
					current += step;
					if (current < 0) current = select.options.length - 1;
					if (current >= select.options.length) current = 0;

					select.selectedIndex = current;
					updateKaomoji();
					playTick();

					i++;
					if (i < diff) {
						delay += 5; // slows down
						setTimeout(frame, delay);
					} else {
						select.selectedIndex = targetIndex;
						updateKaomoji();
						if (callback) callback();
					}
				}

				frame();
			}

			btnRandom.addEventListener("click", () => {
				const diceOverlay = document.getElementById("dice-overlay");
				diceOverlay.classList.add("animate");

				preview.style.userSelect = "none";
				preview.style.cursor = "progress";
				preview.title = "";

				const idxFace = Math.floor(Math.random() * options.faceLeft.length);
				const idxEye = Math.floor(Math.random() * options.eyeLeft.length);
				const idxMouth = Math.floor(Math.random() * options.mouth.length);
				const idxArmLeft = Math.floor(Math.random() * options.armLeft.length);
				const idxArmRight = Math.floor(Math.random() * options.armRight.length);
				let idxExtraLeft = Math.floor(Math.random() * options.extraLeft.length);
				let idxExtraRight = Math.floor(
					Math.random() * options.extraRight.length
				);

				// Synchronizes if any is 7 or 11
				if (idxExtraLeft === 6 || idxExtraRight === 6) {
					idxExtraLeft = idxExtraRight = 6;
				} else if (idxExtraLeft === 10 || idxExtraRight === 10) {
					idxExtraLeft = idxExtraRight = 10;
				}

				if (slotMachineActive) {
					// staggered animation
					animateOrChange(parts.faceLeft, idxFace);
					animateOrChange(parts.faceRight, idxFace);

					setTimeout(() => {
						animateOrChange(parts.eyeLeft, idxEye);
						animateOrChange(parts.eyeRight, idxEye);
					}, 200);

					setTimeout(() => {
						animateOrChange(parts.mouth, idxMouth);
					}, 400);

					setTimeout(() => {
						animateOrChange(parts.armLeft, idxArmLeft);
						animateOrChange(parts.armRight, idxArmRight);
					}, 600);

					setTimeout(() => {
						animateOrChange(parts.extraLeft, idxExtraLeft);
						animateOrChange(parts.extraRight, idxExtraRight);
					}, 800);
				} else {
					// changes everything at once
					parts.faceLeft.selectedIndex = idxFace;
					parts.faceRight.selectedIndex = idxFace;
					parts.eyeLeft.selectedIndex = idxEye;
					parts.eyeRight.selectedIndex = idxEye;
					parts.mouth.selectedIndex = idxMouth;
					parts.armLeft.selectedIndex = idxArmLeft;
					parts.armRight.selectedIndex = idxArmRight;
					parts.extraLeft.selectedIndex = idxExtraLeft;
					parts.extraRight.selectedIndex = idxExtraRight;
					updateKaomoji();
				}

				setTimeout(() => {
					diceOverlay.classList.remove("animate");
					preview.style.userSelect = "auto";
					preview.style.cursor = "pointer";
					preview.title = PRE_TITLE;
				}, 1500);
			});

			updateKaomoji();
		</script>

		<script>
			// Preloader management
			window.addEventListener("load", function () {
				const preloader = document.getElementById("preloader");
				setTimeout(() => {
					preloader.classList.add("hidden");
					// Remove preloader from DOM after transition
					setTimeout(() => {
						preloader.remove();
					}, 500);
				}, 500); // Minimum loading time for better UX
			});
		</script>
	</body>
</html>
